<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
            background: url('./assets/images/bg.jpeg') no-repeat 0px 0px;
            background-repeat: no-repeat;
            background-size: 100% 100%;
            -moz-background-size: 100% 100%;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        #loginDiv {
            width: 37%;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 380px; /* 增加高度以容纳验证码 */
            background-color: rgba(75, 81, 95, 0.3);
            box-shadow: 7px 7px 17px rgba(52, 56, 66, 0.5);
            border-radius: 5px;
        }

        #name_trip {
            margin-left: 50px;
            color: red;
        }

        p {
            margin-top: 30px;
            margin-left: 20px;
            color: azure;
        }

        input {
            margin-left: 15px;
            border-radius: 5px;
            border-style: hidden;
            height: 30px;
            width: 140px;
            background-color: rgba(216, 191, 216, 0.5);
            outline: none;
            color: #f0edf3;
            padding-left: 10px;
        }

        .button {
            border-color: cornsilk;
            background-color: rgba(100, 149, 237, .7);
            color: aliceblue;
            border-style: hidden;
            border-radius: 5px;
            width: 120px;
            height: 40px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }

        .button:hover {
            background-color: rgba(70, 130, 180, .8);
        }

        #captcha {
            margin-top: 30px;
            color: azure;
        }

        #captchaDiv {
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #captchaImage {
            width: 120px;
            height: 40px;
            background-color: rgba(70, 130, 180, 0.8); /* 匹配按钮的背景色 */
            color: white;
            font-weight: bold;
            font-size: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
        }

        #captchaInput {
            width: 100px;
            margin-left: 10px;
            padding-left: 5px;
            height: 30px;
            border-radius: 5px;
            background-color: rgba(216, 191, 216, 0.5);
            color: white;
            border: none;
            outline: none;
        }

        #captchaLink {
            margin-left: 10px;
            font-size: 14px;
            color: azure;
            text-decoration: none;
            cursor: pointer;
        }

        #captchaLink:hover {
            color: blue;
        }
    </style>
</head>

<body>
    <div id="loginDiv">
        <form action="" id="form">
            <h1 style="text-align: center;color: aliceblue;">用户登录</h1>
            <p>用户名:<input id="userNname" type="text"><label id="name_trip"></label></p>
            <p>密&nbsp;&nbsp;码: <input id="password" type="password"><label id="password_trip"></label></p>

            <!-- 验证码部分 -->
            <p id="captcha">请输入验证码：<input type="text" id="captchaInput" placeholder="验证码" /></p>
            <div id="captchaDiv">
                <!-- 动态生成的 img 标签用于显示验证码 -->
                <img id="captchaImage" alt="验证码" width="120" height="40" style="border-radius: 5px;">
                <a href="javascript:void(0);" id="captchaLink" onclick="generateCaptcha()">刷新验证码</a>
            </div>

            <div style="text-align: center;margin-top: 30px;">
                <input type="submit" class="button" value="登录">
                <a href="./register.html">
                    <input type="button" class="button" value="注册">
                </a>
            </div>
        </form>
    </div>

    <script>
        let captchaCode = '';

        // 生成验证码
        function generateCaptcha() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let captcha = '';
            for (let i = 0; i < 6; i++) {
                captcha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            captchaCode = captcha;  // 存储生成的验证码

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 120;
            canvas.height = 40;

            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 绘制背景
            ctx.fillStyle = '#6A5ACD';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 绘制验证码文本
            ctx.font = '20px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(captcha, canvas.width / 2, canvas.height / 2);

            // 绘制一些干扰线
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.stroke();
            }

            // 将 canvas 内容转为图片 URL
            const imageUrl = canvas.toDataURL();

            // 设置 img 标签的 src 属性为生成的图像 URL
            document.getElementById('captchaImage').src = imageUrl;
        }

        // 页面加载时生成验证码
        generateCaptcha();

        document.getElementById('form').addEventListener('submit', function (e) {
    e.preventDefault(); // 防止表单默认提交行为

    const username = document.getElementById('userNname').value;
    const password = document.getElementById('password').value;
    const captchaInput = document.getElementById('captchaInput').value;

    // 将用户输入的验证码和生成的验证码都转换为小写
    const captchaInputLower = captchaInput.toLowerCase();
    const captchaCodeLower = captchaCode.toLowerCase();

    // 从 localStorage 中获取注册时保存的数据
    const savedData = localStorage.getItem('userRegistrationData');
    const formData = savedData ? JSON.parse(savedData) : null;

    // 验证用户名、密码和验证码
    if (!username || !password || !captchaInput) {
        alert('请输入用户名、密码和验证码！');
        return;
    }

    if (captchaInputLower !== captchaCodeLower) {  // 比较小写形式
        alert('验证码错误！');
        return;
    }

    if (formData) {
        if (formData.username === username && formData.password === password) {
            alert('登录成功！');
            // 可以在此跳转到主页或者其他页面
            window.location.href = './home.html'; // 假设登录成功后跳转到主页
        } else {
            alert('用户名或密码错误！');
        }
    } else {
        alert('没有找到注册的用户数据，请先注册！');
    }
});

    </script>
</body>

</html>
